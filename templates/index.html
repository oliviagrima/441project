<!DOCTYPE html>
<html>
<head>
    <title>JSON Reader</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        .box { border: 1px solid #aaa; padding: 15px; margin-bottom: 20px; }
        input { width: 300px; padding: 5px; }
        button { padding: 8px 12px; }
        pre { background: #eee; padding: 10px; }
    </style>
</head>
<body>

<h1>Read JSON Data</h1>

<div class="box">
    <h2>Read Turret JSON</h2>

    <label>URL:</label><br>
    <input id="turretUrl" type="text" placeholder="Enter JSON URL"><br><br>

    <label>Team ID:</label><br>
    <input id="teamId" type="number" placeholder="Team #"><br><br>

    <button onclick="loadTurret()">Get Turret Position</button>
    <button onclick="moveToTurret()">Move Motor to θ</button>
    
    <h3>Result:</h3>
    <pre id="turretResult"></pre>
</div>

<div class="box">
    <h2>Read Target List</h2>

    <label>URL:</label><br>
    <input id="targetUrl" type="text" placeholder="Enter JSON URL"><br><br>

    <button onclick="loadTargets()">Get Targets</button>

    <h3>Select Target:</h3>
    <select id="targetSelect"></select>
    <button onclick="moveToSelectedTarget()">Move Motor</button>

    <h3>Result:</h3>
    <pre id="targetResult"></pre>
</div>

<script>
function loadTurret() {
    const url = document.getElementById("turretUrl").value;
    const team = document.getElementById("teamId").value;

    fetch("/read_json", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ url: url, team: team })
    })
    .then(res => res.json())
    .then(data => {
        document.getElementById("turretResult").textContent = JSON.stringify(data, null, 2);
    });
}

function loadTargets() {
    const url = document.getElementById("targetUrl").value;

    fetch("/read_targets", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ url: url })
    })
    .then(res => res.json())
    .then(data => {
        document.getElementById("targetResult").textContent = JSON.stringify(data, null, 2);

        const select = document.getElementById("targetSelect");
        select.innerHTML = "";  // clear old entries

        if (!data.targets) return;

        // Populate dropdown with theta values
        data.targets.forEach((t, index) => {
            const option = document.createElement("option");
            option.value = t.theta;
            option.textContent = `Target ${index+1} — θ = ${t.theta}`;
            select.appendChild(option);
        });
    });
}

function moveToSelectedTarget() {
    const theta = document.getElementById("targetSelect").value;

    if (!theta) {
        alert("No target selected!");
        return;
    }

    fetch("/move_motor", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            motor: 1,
            angle: parseFloat(theta)
        })
    })
    .then(res => res.json())
    .then(data => {
        alert("Motor moving to θ = " + theta);
    });
}

</script>

</body>
</html>
